name: C/C++ CI - Compilation

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - '**.cpp'
      - '**.h'
  pull_request:
    branches: [ "main" ]
    paths:
      - '**.cpp'
      - '**.h'
jobs:
  compile_and_test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Install Dependencies
      run: |
        sudo apt install -y unzip
        sudo apt install -y wget
        sudo apt install -y rsync
        wget https://download.ni.com/support/softlib/MasterRepository/LinuxDrivers2023Q4/NILinux2023Q4DeviceDrivers.zip
        unzip NILinux2023Q4DeviceDrivers.zip
        cd NILinux2023Q4DeviceDrivers
        sudo dpkg -i ni-ubuntu*
        sudo apt update
        sudo apt install -y ni-syscfg-devel
        sudo apt install -y ni-flexrio-modulario-libs-devel
        sudo apt install -y libpugixml-dev
        sudo apt install -y libgtest-dev
        
    - name: Compile Code
      run: make compile -j

    - name: Run Unit Tests IrioV2Cpp
      run: |
        cd target/test/c++/unittests/irio_v2_cpp
        ./test_ut_iriov2cpp
